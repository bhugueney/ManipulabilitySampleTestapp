
#include "Com.h"

#include <vector>

namespace factories
{
struct ComFactoryPimpl{
	ComFactoryPimpl()
	{
		int none = None;
		for(int i=0; i <= none; ++i)
		{
			coms.push_back(CreateCom(static_cast<eSegmentMembers>(i)));
		}
	}
	
	~ComFactoryPimpl()
	{
		// NOTHING
	}

	std::vector<Com> coms;
	Com CreateCom(eSegmentMembers member)
	{
		switch (member)
		{
			case ForeArm:
				{
					return Com(0.022f, 0.682f);
				}
			case UpperAm:
				{
					return Com(0.028f, 0.436f);
				}
			case Thigh:
				{
					return Com(0.1f, 0.433f);
				}
			case Calf:
				{
					return Com(0.061f, 0.606f);
				}
			case Head:
				{
					return Com(0.081f, 1.f);
				}
			case Trunk:
				{
					return Com(0.497f, 0.5f);
				}
			default:
				return Com();
		}
	}
};
}

using namespace factories;


Com::Com(float weight, float distanceFromProximal)
	: weight_(weight)
	, distanceFromProximal_(distanceFromProximal)
{
	// NOTHING
}

Com::~Com()
{
	// NOTHING
}

matrices::Vector3 Com::Compute(const matrices::Vector3& segment) const
{
	return segment * distanceFromProximal_;
}


ComFactory::ComFactory()
	: pImpl_(new ComFactoryPimpl())
{
	// NOTHING
}


ComFactory::~ComFactory()
{
	// NOTHING
}

// LIB M2S, table de Dempster(1955)
const Com& ComFactory::CreateCom(eSegmentMembers member) const
{
	return pImpl_->coms[(int)(member)];
}

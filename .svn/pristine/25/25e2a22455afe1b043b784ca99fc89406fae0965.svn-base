
#ifndef _CLASS_JACOBIAN
#define _CLASS_JACOBIAN

#include "MatrixDefs.h"

class Tree;

class Jacobian {

public:
	 Jacobian(const Tree& tree);
	~Jacobian();

public:
	void  SetJacobian(const matrices::MatrixX jacobian);
	void  ComputeAll(const Tree& tree); // recomputes jacobian
	void  ComputeAll(); // recomputes everything but the jacobian
	void  ComputeJacobian(const Tree& tree);
	const matrices::MatrixX& GetNullspace();
	const matrices::MatrixX& GetJacobian();
		  matrices::MatrixX  GetJacobianCopy();
	const matrices::MatrixX& GetJacobianInverse();
	const matrices::Matrix3& GetJacobianProduct();
	const matrices::Matrix3& GetJacobianProductInverse();

	void  GetNullspace( const matrices::MatrixX /*pseudoId*/, matrices::MatrixX& /*result*/);

private:
	void ComputeSVD();

private:
	bool computeInverse_;
	bool computeProduct_;
	bool computeProductInverse_;
	bool computeJacSVD_;
	bool computeNullSpace_;
	void Invalidate();

private:
	matrices::Matrix3 jacobianProductInverse_;
	matrices::Matrix3 jacobianProduct_;
	matrices::MatrixX jacobian_;
	matrices::MatrixX jacobianInverse_;
	matrices::MatrixX jacobianInverseNoDls_;
	matrices::MatrixX Identitymin_;
	Eigen::JacobiSVD<matrices::MatrixX> svd_;
};
#endif //_CLASS_JACOBIAN